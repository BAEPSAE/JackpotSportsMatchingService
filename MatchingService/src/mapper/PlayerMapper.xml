<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="mapper.PlayerMapper">

  <!-- 개인정보 가져오기 -->
   <select id="getUserInfo" parameterType="String" resultType="Player">
      SELECT*FROM PLAYER WHERE USER_ID=#{user_Id}
   </select>
   
   <!-- 종목별 전적 가져오기 -->
   <select id="getUserRecord" parameterType="String" resultType="Record">
      SELECT R.* FROM PLAYER P, RECORD R WHERE P.RECORD_ID=R.RECORD_ID AND P.USER_ID=#{user_Id}
   </select>
   
   <!-- 종목별 경기장 정보 가져오기 -->
   <select id="getUserGround" parameterType="HashMap" resultType="Grounds">
      SELECT G.LOCATION
      , G.GROUND_NAME
      , G.GROUND_OWN
      , G.GROUND_PHONE
      , G.GROUND_ADDRESS
      FROM GROUNDS G, 
        (SELECT GROUND_ID, COUNT(GROUND_ID)AS GROUNDS
        <if test="sports==1">
        	FROM (SELECT GAME_TYPE, GROUND_ID, WINNER_ID FROM GAMES WHERE WINNER_ID=#{user_Id} AND GAME_TYPE='축구')
        </if>
        <if test="sports==2">
        	FROM (SELECT GAME_TYPE, GROUND_ID, WINNER_ID FROM GAMES WHERE WINNER_ID=#{user_Id} AND GAME_TYPE='야구')
        </if>
        <if test="sports==3">
        	FROM (SELECT GAME_TYPE, GROUND_ID, WINNER_ID FROM GAMES WHERE WINNER_ID=#{user_Id} AND GAME_TYPE='탁구')
        </if>
        <if test="sports==4">
        	FROM (SELECT GAME_TYPE, GROUND_ID, WINNER_ID FROM GAMES WHERE WINNER_ID=#{user_Id} AND GAME_TYPE='볼링')
        </if>
        WHERE ROWNUM=1
        GROUP BY GROUND_ID
        ORDER BY GROUNDS DESC) GA 
      WHERE GA.GROUND_ID=G.GROUND_ID
   </select>


  <!-- 팀 소속 멤버리스트 -->
   <select id="getPlayerList" resultType="Player" parameterType="HashMap">
   		select * from PLAYER 
   		<if test="selector==1">
   			where TEAM1=#{team_Id} and TEAM1_FLAG=#{type}
   		</if>
   		<if test="selector==2">
   			where TEAM2=#{team_Id} and TEAM2_FLAG=#{type}
   		</if>
   		order by user_name
   		
   </select>
   
	<!-- 회원 가입 -->
	<insert id="insertRecord">
		INSERT INTO RECORD (record_id) values (SEQ_RECORD.nextval)
	</insert>
	<insert id="insertPlayer" parameterType="Player">
		INSERT INTO PLAYER (user_id, user_name,user_pw,user_location,user_phone,record_id,savefileName) VALUES (#{user_Id}, #{user_Name}, #{user_Pw}, #{user_Location}, #{user_Phone},SEQ_RECORD.currval,#{saveFileName})
	</insert>
	
	<!-- 로그인 -->
	<select id="getUser" parameterType="Player" resultType="player">
		SELECT * FROM PLAYER WHERE USER_ID=#{user_Id} AND USER_PW=#{user_Pw}
	</select>
	
	<!-- 업데이트 -->
	<update id="changeTeam" parameterType="HashMap">
		update PLAYER set
		<if test="selector==1">
			TEAM1=#{team, jdbcType=INTEGER}
			, TEAM1_FLAG=#{team_flag, jdbcType=INTEGER}
		</if>
		<if test="selector==2">
			TEAM2=#{team}
			, TEAM2_FLAG=#{team_flag, jdbcType=INTEGER}
		</if>
		 where USER_ID=#{user_Id, jdbcType=INTEGER}
	</update>	
	
	
</mapper>
